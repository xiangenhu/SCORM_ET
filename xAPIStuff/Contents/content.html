<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

	<script language=javascript src="util/APIWrapper.js"></script>
	<script language=javascript src="ET.js"></script>

	<script language=javascript>
        // Set some variables global to the SCO
        var answer = -1;
        var exitPageStatus = false;
        var ATType = GetQueryVar("ATType", "AutoTutorDR")
        var BundleTitle = GetQueryVar("T", "Transistor");
        var ATScoreMessage;
        var ATKcName;
        var ATScore;
        var Threshold = 0.5;

        window.addEventListener("message",
        	function submitScore(evt) {
        		if (evt.origin === "http://prod.x-in-y.com" || evt.origin === "https://prod.x-in-y.com") {
        			ATScoreMessage = evt.data;
        			var getScore = ATScoreMessage.ETScore;
        			if (getScore == true) {
        				ATKcName = ATScoreMessage.KcName;
        				ATScore = ATScoreMessage.KcScore;
        			}
        		}
        		document.getElementById("ATscore").innerHTML = 'Topic Name: ' + BundleTitle + '<br>' + 'Type of Question: ' + ATType + '<br>' + 'Knowledge Component: ' + ATKcName + '<br>' + 'Score: ' + ATScore + '<br>' + 'Overall Performance (Threshold  = 0.5): ' + val;

        	},
        	false);

        function GetQueryVar(search_for, defaultstr) {
        	var query = window.location.search.substring(1);
        	var parms = query.split('&');
        	for (var i = 0; i < parms.length; i++) {
        		var pos = parms[i].indexOf('=');
        		if (pos > 0 && search_for == parms[i].substring(0, pos)) {
        			return parms[i].substring(pos + 1);
        		}
        	}
        	return defaultstr;
        }
        function loadPage() {
        	var result = doInitialize();
        	var html = '<div style="padding: 15px 20px;  font-weight: bold;">';
        	html += '<span id="ATscore"></span>';
        	html += '</div>';
        	html += '<iframe src="' + GetLinks(ATType) + '" width="900" height="768" frameborder="0"/>';
        	
        	document.getElementById("disp").innerHTML = html;
        }


    </script>
</head>
<body onLoad="loadPage()">


	<div class="row">
		<div class="col-sm-8">
			<div id="disp" name="disp"></div>
		</div>
		<div class="col-sm-4">
			<form class="form-group">
				<label for="user">UserName:</label>
				<select class="form-control" id = user>
					<option value="joe@gmail.com">joe</option>
					<option value="john@yahoo.com">john</option>
					<option value="jane@hotmail.com">jane</option>
				</select>
				<br>
				<label for="Resources">Learning Resource:</label>
				<select class="form-control" id = Resources>
					<option value="autotutor">Autotutor</option>
					<option value="dragoon">Dragoon</option>
					<option value="bbn">BBN </option>
				</select>
				<br/>
				<label for="verb">Performance (verb):</label>
				<select class="form-control" id = "verb">
					<option value="passed">Pass</option>
					<option value="failed">Fail</option>
				</select>
				<br>
				<label for="score">Score (0-1):</label>
				<input type="number" id="score" value=0.75>
				<br>
				<input id = "KC1" type="checkbox" name="KC1" value="KC1"> KC1<br>
				<input type="checkbox" name="KC2" value="KC2"> KC2<br>
				<input type="checkbox" name="KC3" value="KC3"> KC3<br>

				<button type="button" class="btn btn-primary" onclick="SendToParent()" >Send</button>

			</form>
		</div>
	</div>

	

	<script type="text/javascript">
		var dt;

		

		

		function SendToParent(){
			var KCS = [];

			$("input:checkbox").each(function() {
				if($(this).is( ":checked" )){
					KCS.push($(this).val());
				}
				KCS.push();

			});
console.log("kcs" + KCS);

			sendData = {
				userID : document.getElementById("user").value,
				Resource : document.getElementById("Resources").value,
				verbVal : document.getElementById("verb").value,
				sScore : document.getElementById("score").value,
				kcs : KCS
			}
			
			parent.send(sendData); 
			//parent.CatchIframeMessage("hi");
		//alert(document.getElementById('Resources').value + " " + document.getElementById('Performance').value + " " + document.getElementById('KC1').checked)
	}
</script>

</body>
</html>
